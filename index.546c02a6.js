class e{#e;#t;#r;#l;constructor(e,t=.9>Math.random()?2:4){this.#e=document.createElement("div"),this.#e.classList.add("tile"),e.append(this.#e),this.value=t}get value(){return this.#l}set value(e){this.#l=e,this.#e.textContent=e;let{background:t,textColor:r}=function(e){let t={};switch(e){case 2:t={background:"#eee4da",textColor:"#776e65"};break;case 4:t={background:"#ede0c8",textColor:"#776e65"};break;case 8:t={background:"#f2b179",textColor:"#f9f6f2"};break;case 16:t={background:"#f59563",textColor:"#f9f6f2"};break;case 32:t={background:"#f67c5f",textColor:"#f9f6f2"};break;case 64:t={background:"#f65e3b",textColor:"#f9f6f2"};break;case 128:t={background:"#edcf72",textColor:"#f9f6f2"};break;case 256:t={background:"#edcc61",textColor:"#f9f6f2"};break;case 512:t={background:"#edc850",textColor:"#f9f6f2"};break;case 1024:t={background:"#edc53f",textColor:"#f9f6f2"};break;case 2048:t={background:"#edc22e",textColor:"#f9f6f2"}}return t}(e);this.#e.style.setProperty("--background-color",t),this.#e.style.setProperty("--text-color",r)}set x(e){this.#t=e,this.#e.style.setProperty("--x",e)}get x(){return this.#t}set y(e){this.#r=e,this.#e.style.setProperty("--y",e)}get y(){return this.#r}remove(){this.#e.remove()}waitForTransition(e=!1){return new Promise(t=>{this.#e.addEventListener(e?"animationend":"transitionend",t,{once:!0})})}}var t={};let r=0;class l{static Statuses={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};#s;constructor(e){e.style.setProperty("--grid-size",4),e.style.setProperty("--cell-size","75px"),e.style.setProperty("--cell-gap","10px"),this.#s=(function(e){let t=[];for(let r=0;r<16;r++){let r=document.createElement("div");r.classList.add("cell"),t.push(r),e.append(r)}return t})(e).map((e,t)=>new s(e,t%4,Math.floor(t/4))),r=0,this.status=l.Statuses.IDLE,this.board=[[0,4,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}get cells(){return this.#s}get cellsByRow(){return this.#s.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}get cellsByColumn(){return this.#s.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}get #i(){return this.#s.filter(e=>null==e.tile)}randomEmptyCell(){let e=Math.floor(Math.random()*this.#i.length);return this.#i[e]}moveLeft(){return this.slideTiles(this.cellsByRow)}moveRight(){return this.slideTiles(this.cellsByRow.map(e=>[...e].reverse()))}moveUp(){return this.slideTiles(this.cellsByColumn)}moveDown(){return this.slideTiles(this.cellsByColumn.map(e=>[...e].reverse()))}slideTiles(e){return Promise.all(e.flatMap(e=>{let t=[];for(let r=1;r<e.length;r++){let l;let s=e[r];if(null!=s.tile){for(let t=r-1;t>=0;t--){let r=e[t];if(!r.canAccept(s.tile))break;l=r}null!=l&&(t.push(s.tile.waitForTransition()),null!=l.tile?l.mergeTile=s.tile:l.tile=s.tile,s.tile=null)}}return t}))}getScore(){return r}getState(){return this.board}getStatus(){return this.status}setStatus(e){this.status=e}start(){this.status=l.Statuses.PLAYING}checkForWin(){let e=!1;return this.cells.forEach(t=>{null!=t.tile&&2048===t.tile.value&&(e=!0)}),e}restart(){document.querySelectorAll(".tile").forEach(e=>e.remove()),r=0,this.status=l.Statuses.PLAYING,this.#s.forEach(e=>{e.tile=null,e.mergeTile=null})}}class s{#n;#t;#r;#a;#o;constructor(e,t,r){this.#n=e,this.#t=t,this.#r=r}get x(){return this.#t}get y(){return this.#r}get tile(){return this.#a}set tile(e){this.#a=e,null!=e&&(this.#a.x=this.#t,this.#a.y=this.#r)}get mergeTile(){return this.#o}set mergeTile(e){this.#o=e,null!=e&&(this.#o.x=this.#t,this.#o.y=this.#r)}canAccept(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}mergeTiles(){null!=this.tile&&null!=this.mergeTile&&(r+=this.tile.value+this.mergeTile.value,this.tile.value=this.tile.value+this.mergeTile.value,this.mergeTile.remove(),this.mergeTile=null)}}t=l;const i=document.querySelector(".start"),n=document.querySelector(".game-board"),a=document.querySelector(".game-score"),o=document.querySelector(".message-container").children,c=new t(n);function u(){a.textContent=c.getScore()}function h(){let[e,r,l]=o,s=c.getStatus(),i="hidden";switch(Array.from(o).forEach(e=>{e.classList.add(i)}),s){case t.Statuses.IDLE:l.classList.remove(i);break;case t.Statuses.WIN:r.classList.remove(i);break;case t.Statuses.LOSE:e.classList.remove(i)}}function m(){let e=!1;document.addEventListener("touchstart",t=>{if(t.preventDefault(),e)return;e=!0;let r=t.touches[0].clientX,l=t.touches[0].clientY,s=!1;document.addEventListener("touchend",t=>{if(t.preventDefault(),s)return;s=!0;let i=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY,a=i-r,o=n-l,c=Math.abs(a),u=Math.abs(o),h={key:"-"};if(c<100&&u<100){e=!1,s=!1,m();return}c>100?a>0?h.key="ArrowRight":h.key="ArrowLeft":Math.abs(o)>100&&(o>0?h.key="ArrowDown":h.key="ArrowUp"),f(h),e=!1,s=!1},{once:!0})},{once:!0})}async function f(r){if(c.getStatus()!==t.Statuses.PLAYING)return;switch(r.key){case"ArrowUp":if(!g()){d();return}await c.moveUp();break;case"ArrowDown":if(!w()){d();return}await c.moveDown();break;case"ArrowLeft":if(!v()){d();return}await c.moveLeft();break;case"ArrowRight":if(!k()){d();return}await c.moveRight();break;default:m();return}if(c.cells.forEach(e=>e.mergeTiles()),c.checkForWin()){c.setStatus(t.Statuses.WIN),h();return}let l=new e(n);if(c.randomEmptyCell().tile=l,!g()&&!w()&&!v()&&!k()){l.waitForTransition(!0).then(()=>{c.setStatus(t.Statuses.LOSE),h()});return}u(),h(),m()}function d(){window.addEventListener("keyup",y,{once:!0})}async function y(r){if(c.getStatus()!==t.Statuses.PLAYING)return;switch(r.key){case"ArrowUp":if(!g()){d();return}await c.moveUp();break;case"ArrowDown":if(!w()){d();return}await c.moveDown();break;case"ArrowLeft":if(!v()){d();return}await c.moveLeft();break;case"ArrowRight":if(!k()){d();return}await c.moveRight();break;default:d();return}if(c.cells.forEach(e=>e.mergeTiles()),c.checkForWin()){c.setStatus(t.Statuses.WIN),h();return}let l=new e(n);if(c.randomEmptyCell().tile=l,!g()&&!w()&&!v()&&!k()){l.waitForTransition(!0).then(()=>{c.setStatus(t.Statuses.LOSE),h()});return}u(),h(),d()}function g(){return p(c.cellsByColumn)}function w(){return p(c.cellsByColumn.map(e=>[...e].reverse()))}function v(){return p(c.cellsByRow)}function k(){return p(c.cellsByRow.map(e=>[...e].reverse()))}function p(e){return e.some(e=>e.some((t,r)=>0!==r&&null!=t.tile&&e[r-1].canAccept(t.tile)))}i.addEventListener("click",()=>{i.classList.contains("start")?(i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart",c.start(),h(),c.randomEmptyCell().tile=new e(n),c.randomEmptyCell().tile=new e(n),d(),m()):i.classList.contains("restart")&&(c.restart(),a.innerHTML=0,h(),c.randomEmptyCell().tile=new e(n),c.randomEmptyCell().tile=new e(n),d(),m())});
//# sourceMappingURL=index.546c02a6.js.map
