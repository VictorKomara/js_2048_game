!function(){function e(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){r(e);return}u.done?t(s):Promise.resolve(s).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,o){var a=t.apply(r,n);function u(t){e(a,i,o,u,s,"next",t)}function s(t){e(a,i,o,u,s,"throw",t)}u(void 0)})}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}function i(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(s){return function(u){if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t,r){if(!t.has(e))throw TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function s(e,t){var r=u(e,t,"get");return r.get?r.get.call(e):r.value}function l(e,t,r){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function c(e,t,r){var n=u(e,t,"set");return!function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=r}}(e,n,r),r}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}"function"==typeof SuppressedError&&SuppressedError;var y,v,d=/*#__PURE__*/new WeakMap,p=/*#__PURE__*/new WeakMap,m=/*#__PURE__*/new WeakMap,b=/*#__PURE__*/new WeakMap,w=/*#__PURE__*/function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9>Math.random()?2:4;a(this,e),l(this,d,{writable:!0,value:void 0}),l(this,p,{writable:!0,value:void 0}),l(this,m,{writable:!0,value:void 0}),l(this,b,{writable:!0,value:void 0}),c(this,d,document.createElement("div")),s(this,d).classList.add("tile"),t.append(s(this,d)),this.value=r}return h(e,[{key:"value",get:function(){return s(this,b)},set:function(e){c(this,b,e),s(this,d).textContent=e;var t=function(e){var t={};switch(e){case 2:t={background:"#eee4da",textColor:"#776e65"};break;case 4:t={background:"#ede0c8",textColor:"#776e65"};break;case 8:t={background:"#f2b179",textColor:"#f9f6f2"};break;case 16:t={background:"#f59563",textColor:"#f9f6f2"};break;case 32:t={background:"#f67c5f",textColor:"#f9f6f2"};break;case 64:t={background:"#f65e3b",textColor:"#f9f6f2"};break;case 128:t={background:"#edcf72",textColor:"#f9f6f2"};break;case 256:t={background:"#edcc61",textColor:"#f9f6f2"};break;case 512:t={background:"#edc850",textColor:"#f9f6f2"};break;case 1024:t={background:"#edc53f",textColor:"#f9f6f2"};break;case 2048:t={background:"#edc22e",textColor:"#f9f6f2"}}return t}(e),r=t.background,n=t.textColor;s(this,d).style.setProperty("--background-color",r),s(this,d).style.setProperty("--text-color",n)}},{key:"x",get:function(){return s(this,p)},set:function(e){c(this,p,e),s(this,d).style.setProperty("--x",e)}},{key:"y",get:function(){return s(this,m)},set:function(e){c(this,m,e),s(this,d).style.setProperty("--y",e)}},{key:"remove",value:function(){s(this,d).remove()}},{key:"waitForTransition",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(r){s(e,d).addEventListener(t?"animationend":"transitionend",r,{once:!0})})}}]),e}(),k={},g=0,S=/*#__PURE__*/new WeakMap,E=/*#__PURE__*/new WeakMap,L=/*#__PURE__*/function(){function e(t){a(this,e),l(this,E,{get:x,set:void 0}),l(this,S,{writable:!0,value:void 0}),t.style.setProperty("--grid-size",4),t.style.setProperty("--cell-size","".concat(75,"px")),t.style.setProperty("--cell-gap","".concat(10,"px")),c(this,S,(function(e){for(var t=[],r=0;r<16;r++){var n=document.createElement("div");n.classList.add("cell"),t.push(n),e.append(n)}return t})(t).map(function(e,t){return new P(e,t%4,Math.floor(t/4))})),g=0,this.status=e.Statuses.IDLE,this.board=[[0,4,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}return h(e,[{key:"cells",get:function(){return s(this,S)}},{key:"cellsByRow",get:function(){return s(this,S).reduce(function(e,t){return e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e},[])}},{key:"cellsByColumn",get:function(){return s(this,S).reduce(function(e,t){return e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e},[])}},{key:"randomEmptyCell",value:function(){var e=Math.floor(Math.random()*s(this,E).length);return s(this,E)[e]}},{key:"moveLeft",value:function(){return this.slideTiles(this.cellsByRow)}},{key:"moveRight",value:function(){return this.slideTiles(this.cellsByRow.map(function(e){return i(e).reverse()}))}},{key:"moveUp",value:function(){return this.slideTiles(this.cellsByColumn)}},{key:"moveDown",value:function(){return this.slideTiles(this.cellsByColumn.map(function(e){return i(e).reverse()}))}},{key:"slideTiles",value:function(e){return Promise.all(e.flatMap(function(e){for(var t=[],r=1;r<e.length;r++){var n=e[r];if(null!=n.tile){for(var i=void 0,o=r-1;o>=0;o--){var a=e[o];if(!a.canAccept(n.tile))break;i=a}null!=i&&(t.push(n.tile.waitForTransition()),null!=i.tile?i.mergeTile=n.tile:i.tile=n.tile,n.tile=null)}}return t}))}},{key:"getScore",value:function(){return g}},{key:"getState",value:function(){return this.board}},{key:"getStatus",value:function(){return this.status}},{key:"setStatus",value:function(e){this.status=e}},{key:"start",value:function(){this.status=e.Statuses.PLAYING}},{key:"checkForWin",value:function(){var e=!1;return this.cells.forEach(function(t){null!=t.tile&&2048===t.tile.value&&(e=!0)}),e}},{key:"restart",value:function(){document.querySelectorAll(".tile").forEach(function(e){return e.remove()}),g=0,this.status=e.Statuses.PLAYING,s(this,S).forEach(function(e){e.tile=null,e.mergeTile=null})}}]),e}();function x(){return s(this,S).filter(function(e){return null==e.tile})}v={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"},(y="Statuses")in L?Object.defineProperty(L,y,{value:v,enumerable:!0,configurable:!0,writable:!0}):L[y]=v;var A=/*#__PURE__*/new WeakMap,T=/*#__PURE__*/new WeakMap,C=/*#__PURE__*/new WeakMap,M=/*#__PURE__*/new WeakMap,I=/*#__PURE__*/new WeakMap,P=/*#__PURE__*/function(){function e(t,r,n){a(this,e),l(this,A,{writable:!0,value:void 0}),l(this,T,{writable:!0,value:void 0}),l(this,C,{writable:!0,value:void 0}),l(this,M,{writable:!0,value:void 0}),l(this,I,{writable:!0,value:void 0}),c(this,A,t),c(this,T,r),c(this,C,n)}return h(e,[{key:"x",get:function(){return s(this,T)}},{key:"y",get:function(){return s(this,C)}},{key:"tile",get:function(){return s(this,M)},set:function(e){c(this,M,e),null!=e&&(s(this,M).x=s(this,T),s(this,M).y=s(this,C))}},{key:"mergeTile",get:function(){return s(this,I)},set:function(e){c(this,I,e),null!=e&&(s(this,I).x=s(this,T),s(this,I).y=s(this,C))}},{key:"canAccept",value:function(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}},{key:"mergeTiles",value:function(){null!=this.tile&&null!=this.mergeTile&&(g+=this.tile.value+this.mergeTile.value,this.tile.value=this.tile.value+this.mergeTile.value,this.mergeTile.remove(),this.mergeTile=null)}}]),e}();k=L;var W=document.querySelector(".start"),R=document.querySelector(".game-board"),D=document.querySelector(".game-score"),B=document.querySelector(".message-container").children,O=new k(R);function j(){D.textContent=O.getScore()}function N(){var e=function(e){if(Array.isArray(e))return e}(B)||function(e,t){var r,n,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var o=[],a=!0,u=!1;try{for(i=i.call(e);!(a=(r=i.next()).done)&&(o.push(r.value),3!==o.length);a=!0);}catch(e){u=!0,n=e}finally{try{a||null==i.return||i.return()}finally{if(u)throw n}}return o}}(B,3)||n(B,3)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t=e[0],r=e[1],i=e[2],o=O.getStatus(),a="hidden";switch(Array.from(B).forEach(function(e){e.classList.add(a)}),o){case k.Statuses.IDLE:i.classList.remove(a);break;case k.Statuses.WIN:r.classList.remove(a);break;case k.Statuses.LOSE:t.classList.remove(a)}}function F(){var e=!1;document.addEventListener("touchstart",function(t){if(t.preventDefault(),!e){e=!0;var r=t.touches[0].clientX,n=t.touches[0].clientY,i=!1;document.addEventListener("touchend",function(t){if(t.preventDefault(),!i){i=!0;var o=t.changedTouches[0].clientX,a=t.changedTouches[0].clientY,u=o-r,s=a-n,l=Math.abs(u),c=Math.abs(s),f={key:"-"};if(l<100&&c<100){e=!1,i=!1,F();return}l>100?u>0?f.key="ArrowRight":f.key="ArrowLeft":Math.abs(s)>100&&(s>0?f.key="ArrowDown":f.key="ArrowUp"),function(e){U.apply(this,arguments)}(f),e=!1,i=!1}},{once:!0})}},{once:!0})}function U(){return(U=t(function(e){var t,r,n,i,a,u;return o(this,function(o){switch(o.label){case 0:if(O.getStatus()!==k.Statuses.PLAYING)return[2];switch(t=e.key,r="ArrowUp",n="ArrowDown",i="ArrowRight",a="ArrowLeft",t){case r:return[3,1];case n:return[3,3];case a:return[3,5];case i:return[3,7]}return[3,9];case 1:if(!z())return Y(),[2];return[4,O.moveUp()];case 2:case 4:case 6:case 8:return o.sent(),[3,10];case 3:if(!X())return Y(),[2];return[4,O.moveDown()];case 5:if(!H())return Y(),[2];return[4,O.moveLeft()];case 7:if(!$())return Y(),[2];return[4,O.moveRight()];case 9:return F(),[2];case 10:if(O.cells.forEach(function(e){return e.mergeTiles()}),O.checkForWin())return O.setStatus(k.Statuses.WIN),N(),[2];if(u=new w(R),O.randomEmptyCell().tile=u,!z()&&!X()&&!H()&&!$())return u.waitForTransition(!0).then(function(){O.setStatus(k.Statuses.LOSE),N()}),[2];return j(),N(),F(),[2]}})})).apply(this,arguments)}function Y(){window.addEventListener("keyup",G,{once:!0})}function G(e){return q.apply(this,arguments)}function q(){return(q=t(function(e){var t;return o(this,function(r){switch(r.label){case 0:if(O.getStatus()!==k.Statuses.PLAYING)return[2];switch(e.key){case"ArrowUp":return[3,1];case"ArrowDown":return[3,3];case"ArrowLeft":return[3,5];case"ArrowRight":return[3,7]}return[3,9];case 1:if(!z())return Y(),[2];return[4,O.moveUp()];case 2:case 4:case 6:case 8:return r.sent(),[3,10];case 3:if(!X())return Y(),[2];return[4,O.moveDown()];case 5:if(!H())return Y(),[2];return[4,O.moveLeft()];case 7:if(!$())return Y(),[2];return[4,O.moveRight()];case 9:return Y(),[2];case 10:if(O.cells.forEach(function(e){return e.mergeTiles()}),O.checkForWin())return O.setStatus(k.Statuses.WIN),N(),[2];if(t=new w(R),O.randomEmptyCell().tile=t,!z()&&!X()&&!H()&&!$())return t.waitForTransition(!0).then(function(){O.setStatus(k.Statuses.LOSE),N()}),[2];return j(),N(),Y(),[2]}})})).apply(this,arguments)}function z(){return J(O.cellsByColumn)}function X(){return J(O.cellsByColumn.map(function(e){return i(e).reverse()}))}function H(){return J(O.cellsByRow)}function $(){return J(O.cellsByRow.map(function(e){return i(e).reverse()}))}function J(e){return e.some(function(e){return e.some(function(t,r){return 0!==r&&null!=t.tile&&e[r-1].canAccept(t.tile)})})}W.addEventListener("click",function(){W.classList.contains("start")?(W.classList.remove("start"),W.classList.add("restart"),W.textContent="Restart",O.start(),N(),O.randomEmptyCell().tile=new w(R),O.randomEmptyCell().tile=new w(R),Y(),F()):W.classList.contains("restart")&&(O.restart(),D.innerHTML=0,N(),O.randomEmptyCell().tile=new w(R),O.randomEmptyCell().tile=new w(R),Y(),F())})}();
//# sourceMappingURL=index.dd423d1f.js.map
